<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hệ Thống Quay Số May Mắn nhà Gioan</title>
    <style>
        :root {
            --primary-color: #d4a017;
            --bg-color: #1a1a2e;
        }
        body { font-family: 'Arial', sans-serif; background: var(--bg-color); color: white; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        
        .machine-container {
            background: radial-gradient(circle, #2c3e50, #000);
            padding: 40px;
            border-radius: 50%;
            border: 8px solid var(--primary-color);
            box-shadow: 0 0 30px rgba(212, 160, 23, 0.5);
            margin-bottom: 30px;
            width: 300px;
            height: 300px;
            display: flex;
            justify-content: center;
            align-items: center;
            flex-direction: column;
        }

        #display-number {
            font-size: 5rem;
            font-weight: bold;
            letter-spacing: 5px;
            color: #fff;
            text-shadow: 0 0 10px #f1c40f;
        }

        .controls { margin-bottom: 30px; }
        
        button {
            padding: 15px 40px;
            font-size: 1.2rem;
            cursor: pointer;
            border: none;
            border-radius: 30px;
            transition: 0.3s;
            font-weight: bold;
            text-transform: uppercase;
        }

        .btn-spin { background: var(--primary-color); color: #000; }
        .btn-spin:disabled { background: #555; cursor: not-allowed; }
        .btn-spin:hover:not(:disabled) { transform: scale(1.05); background: #ffdb58; }

        .result-board {
            width: 100%;
            max-width: 800px;
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 10px;
        }

        .result-item {
            background: rgba(255,255,255,0.1);
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            border-left: 3px solid var(--primary-color);
            animation: fadeIn 0.5s;
        }

        @keyframes fadeIn { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body>

    <h1>QUAY SỐ TRÚNG THƯỞNG (0000 - 3999)</h1>
    
    <div class="machine-container">
        <div id="display-number">0000</div>
    </div>

    <div class="controls">
        <button id="spinBtn" class="btn-spin" onclick="startSpin()">BẮT ĐẦU QUAY</button>
    </div>

    <h3 id="status">Số đã trúng (0/136):</h3>
    <div class="result-board" id="resultBoard">
        </div>

<script>
    const min = 0;
    const max = 3999;
    let winningNumbers = new Set(); // Dùng Set để chống trùng lặp tuyệt đối
    let isSpinning = false;

    function formatNumber(num) {
        // Hàm thêm số 0 vào trước cho đủ 4 chữ số
        return num.toString().padStart(4, '0');
    }

    function startSpin() {
        if (winningNumbers.size >= (max - min + 1)) {
            alert("Đã quay hết tất cả các số có thể!");
            return;
        }

        const spinBtn = document.getElementById('spinBtn');
        const display = document.getElementById('display-number');
        isSpinning = true;
        spinBtn.disabled = true;

        // Hiệu ứng nhảy số ngẫu nhiên
        let duration = 2000; // Quay trong 2 giây
        let startTime = Date.now();

        const timer = setInterval(() => {
            let randomTemp = Math.floor(Math.random() * (max - min + 1)) + min;
            display.innerText = formatNumber(randomTemp);

            if (Date.now() - startTime >= duration) {
                clearInterval(timer);
                determineWinner();
            }
        }, 50);
    }

    function determineWinner() {
        let finalNumber;
        
        // Vòng lặp do-while đảm bảo lấy được số chưa từng xuất hiện
        do {
            finalNumber = Math.floor(Math.random() * (max - min + 1)) + min;
        } while (winningNumbers.has(finalNumber));

        // Lưu số vào danh sách trúng
        winningNumbers.add(finalNumber);
        
        // Hiển thị số cuối cùng
        const display = document.getElementById('display-number');
        const formatted = formatNumber(finalNumber);
        display.innerText = formatted;
        display.style.color = "#2ecc71"; // Đổi màu xanh khi dừng

        // Cập nhật bảng kết quả
        updateBoard(formatted);

        // Reset trạng thái
        setTimeout(() => {
            display.style.color = "#fff";
            document.getElementById('spinBtn').disabled = false;
            isSpinning = false;
            document.getElementById('status').innerText = `Số đã trúng (${winningNumbers.size}/136):`;
        }, 1000);
    }

    function updateBoard(num) {
        const board = document.getElementById('resultBoard');
        const item = document.createElement('div');
        item.className = 'result-item';
        item.innerText = `Số: ${num}`;
        board.prepend(item); // Đưa số mới nhất lên đầu
    }
</script>

</body>
</html>